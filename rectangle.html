<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Розрахунок прямокутника</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Exo 2", sans-serif;
      margin: 0;
      padding: 24px;
      color: #111;
      background: #fafafa;
    }
    .container {
      margin: 0 auto;
      background: #fff;
      border: 2px dashed #000000;
      padding: 24px;
    }
    h1 {
      margin: 0 0 16px 0;
      font-size: 24px;
    }
    p.subtitle {
      margin: 0 0 24px 0;
      color: #555;
    }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 640px) {
      .grid { grid-template-columns: 1fr; }
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    label {
      font-weight: 600;
    }
    input[type="text"] {
      padding: 10px 12px;
      border: 1px solid #ccc;
      font-size: 16px;
      outline: none;
    }
    input[type="text"]:focus {
      border-color: #0066cc;
      box-shadow: 0 0 0 3px rgba(0,102,204,0.15);
    }
    .error {
      color: #b00020;
      font-size: 13px;
      min-height: 18px;
    }
    .results {
      margin-top: 24px;
      padding: 16px;
      background: #f4f8ff;
      border: 1px solid #e0ecff;
    }
    .results h2 {
      margin: 0 0 8px 0;
      font-size: 18px;
    }
    .results .row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed #d9e6ff;
    }
    .results .row:last-child { border-bottom: none; }
    .value {
      font-variant-numeric: tabular-nums;
      font-weight: 600;
    }
    .footer {
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>Розрахунок прямокутника</h1>

    <form id="rect-form" novalidate>
      <div class="grid">
        <div class="field">
          <label for="length">Довжина</label>
          <input id="length" name="length" type="text" inputmode="decimal" autocomplete="off" placeholder="напр., 10,5 або 10.5" aria-describedby="length-error" />
          <div id="length-error" class="error" aria-live="polite"></div>
        </div>

        <div class="field">
          <label for="width">Ширина</label>
          <input id="width" name="width" type="text" inputmode="decimal" autocomplete="off" placeholder="напр., 7,25 або 7.25" aria-describedby="width-error" />
          <div id="width-error" class="error" aria-live="polite"></div>
        </div>
      </div>
    </form>

    <div class="results" aria-live="polite" aria-atomic="true">
      <h2>Результати</h2>

      <div class="row">
        <div>
          <span id="perimeter-mj">\( P = 2\,(a+b) \)</span>
        </div>
      </div>

      <div class="row">
        <div>
          <span id="area-mj">\( S = ab \)</span>
        </div>
      </div>

      <div class="row">
        <div>
          <span id="diagonal-mj">\( d = \sqrt{a^{2}+b^{2}} \)</span>
        </div>
      </div>
    </div>

    <div class="footer">
      <a href="index.html">На головну</a>
    </div>
  </div>

  <script>
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$'], ['\\(', '\\)']]}
      },
      svg: { fontCache: 'global' },
      startup: {
        pageReady() {
          return MathJax.startup.defaultPageReady().then(() => {
            const perNode = document.getElementById('perimeter-mj');
            const areaNode = document.getElementById('area-mj');
            const diagNode = document.getElementById('diagonal-mj');
            return MathJax.typesetPromise([perNode, areaNode, diagNode]);
          });
        }
      }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-svg.js"></script>

  <script>
    (() => {
      const byId = (id) => document.getElementById(id);

      const lengthInput = byId('length');
      const widthInput  = byId('width');
      const lengthError = byId('length-error');
      const widthError  = byId('width-error');

      const perNode  = byId('perimeter-mj');
      const areaNode = byId('area-mj');
      const diagNode = byId('diagonal-mj');

      const PLACEHOLDERS = {
        per: '\\( P = 2\\,(a+b) \\)',
        area: '\\( S = a\\,b \\)',
        diag: '\\( d = \\sqrt{a^{2}+b^{2}} \\)'
      };

      // Parse number from text, allowing comma or dot as decimal separator
      function toNumber(text) {
        const normalized = String(text || '').trim().replace(',', '.');
        if (normalized === '') return NaN;
        const valid = /^[-+]?(?:\d+(?:\.\d+)?|\.\d+)$/.test(normalized);
        if (!valid) return NaN;
        const n = parseFloat(normalized);
        return Number.isFinite(n) ? n : NaN;
      }

      function showError(node, message) {
        node.textContent = message || '';
      }

      function validateField(input, errorNode, emptyMsg) {
        const raw = input.value;
        const value = toNumber(raw);
        if (raw.trim() === '') {
          showError(errorNode, emptyMsg);
          return null;
        }
        if (!Number.isFinite(value)) {
          showError(errorNode, 'Неправильний формат числа');
          return null;
        }
        if (value <= 0) {
          showError(errorNode, 'Число має бути > 0');
          return null;
        }
        showError(errorNode, '');
        return value;
      }

      function renderPlaceholders() {
        perNode.innerHTML  = PLACEHOLDERS.per;
        areaNode.innerHTML = PLACEHOLDERS.area;
        diagNode.innerHTML = PLACEHOLDERS.diag;
        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise([perNode, areaNode, diagNode]);
        }
      }

      function renderResults(length, width) {
        const perimeter = 2 * (length + width);
        const area = length * width;
        const diagonal = Math.hypot(length, width);

        perNode.innerHTML  = `\\( P = 2\\,(a+b) = 2\\,(${length}+${width}) = ${perimeter} \\)`;
        areaNode.innerHTML = `\\( S = a\\,b = ${length}\\times${width} = ${area} \\)`;
        diagNode.innerHTML = `\\( d = \\sqrt{a^{2}+b^{2}} = \\sqrt{${length}^{2}+${width}^{2}} = ${diagonal} \\)`;

        if (window.MathJax && MathJax.typesetPromise) {
          MathJax.typesetPromise([perNode, areaNode, diagNode]).catch(err =>
            console.error('MathJax typeset error:', err)
          );
        }
      }

      function onInput() {
        const length = validateField(lengthInput, lengthError, 'Введіть довжину');
        const width  = validateField(widthInput,  widthError,  'Введіть ширину');

        if (length != null && width != null) {
          renderResults(length, width);
        } else {
          renderPlaceholders();
        }
      }

      lengthInput.addEventListener('input', onInput);
      widthInput.addEventListener('input', onInput);
    })();
  </script>
</body>
</html>